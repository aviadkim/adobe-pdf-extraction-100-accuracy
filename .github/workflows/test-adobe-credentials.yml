name: Test Adobe Credentials

on:
  workflow_dispatch:

jobs:
  test-credentials:
    runs-on: ubuntu-latest
    steps:
    - name: Test Adobe API Credentials
      env:
        ADOBE_CLIENT_ID: ${{ secrets.ADOBE_CLIENT_ID }}
        ADOBE_CLIENT_SECRET: ${{ secrets.ADOBE_CLIENT_SECRET }}
      run: |
        python - << 'SCRIPT'
        import os
        import requests
        
        print("ðŸ” Testing Adobe PDF Services API credentials...")
        
        client_id = os.getenv('ADOBE_CLIENT_ID')
        client_secret = os.getenv('ADOBE_CLIENT_SECRET')
        
        if not client_id:
            print("âŒ ADOBE_CLIENT_ID not found in GitHub Secrets")
            exit(1)
        if not client_secret:
            print("âŒ ADOBE_CLIENT_SECRET not found in GitHub Secrets")
            exit(1)
        
        print(f"âœ… ADOBE_CLIENT_ID found: {client_id[:8]}...")
        print(f"âœ… ADOBE_CLIENT_SECRET found: {client_secret[:8]}...")
        
        # Test authentication
        print("ðŸ” Testing Adobe API authentication...")
        
        auth_url = "https://ims-na1.adobelogin.com/ims/token/v3"
        auth_data = {
            'client_id': client_id,
            'client_secret': client_secret,
            'grant_type': 'client_credentials',
            'scope': 'openid,AdobeID,read_organizations'
        }
        
        try:
            response = requests.post(auth_url, data=auth_data, timeout=30)
            
            if response.status_code == 200:
                token_data = response.json()
                print("âœ… Adobe API authentication successful!")
                print(f"ðŸ“ Access token received (expires in {token_data.get('expires_in', 'unknown')} seconds)")
                print(f"ðŸŽ¯ Token type: {token_data.get('token_type', 'unknown')}")
            else:
                print(f"âŒ Adobe authentication failed: {response.status_code}")
                print(f"ðŸ“ Response: {response.text}")
                exit(1)
                
        except Exception as e:
            print(f"âŒ Error during authentication: {e}")
            exit(1)
        
        print("ðŸŽ‰ Adobe PDF Services API credentials are working correctly!")
        SCRIPT